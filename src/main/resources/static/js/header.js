(function(){var t,n;t=jQuery,n=function(t){return function(n){var e,o,r;try{return r=t.call(this,n)}catch(t){return e=t,o=function(){throw e},setTimeout(o,1)}finally{return r}}},t.safeFunction=n,t.fn.safeReady=function(t){return this.ready(n(t))},t.fn.safeOn=function(t,e){return this.on(t,n(e))}}).call(this),function(){this.GiSafeStorage=function(){function t(t){this.unsafeStorage=t,this.inMemoryCache={}}return t.prototype.setItem=function(t,n){try{return this.unsafeStorage.setItem(t,n)}catch(e){return e,this.inMemoryCache[t]=n}},t.prototype.getItem=function(t){var n,e;try{e=null!=(n=this.unsafeStorage)?n.getItem(t):void 0}catch(t){t}return e?(delete this.inMemoryCache[t],e):this.inMemoryCache[t]||null},t.prototype.removeItem=function(t){var n;try{null!=(n=this.unsafeStorage)&&n.removeItem(t)}catch(t){t}return delete this.inMemoryCache[t]},t.prototype.clear=function(){var t;try{null!=(t=this.unsafeStorage)&&t.clear()}catch(t){t}return this.inMemoryCache={}},t}()}.call(this),function(){window.giLocalStorage||(window.giLocalStorage=new GiSafeStorage(window.localStorage)),window.angular&&(angular.module("giLocalStorage",[]),angular.module("giLocalStorage").factory("giLocalStorage",function(){return window.giLocalStorage}))}.call(this),function(){window.giSessionStorage||(window.giSessionStorage=new GiSafeStorage(window.sessionStorage)),window.angular&&(angular.module("giSessionStorage",[]),angular.module("giSessionStorage").factory("giSessionStorage",function(){return window.giSessionStorage}))}.call(this),function(){}.call(this),window.angular&&angular.module("giEvents",[]),function(){var t,n,e,o=[].slice;n=1e4,e=function(){function t(t,e){var o,r,i,a,u;this.window=t,this.document=e,this.myLocalStorage=new GiSafeStorage(window.localStorage),a=function(t){var n,e,o;if(o=t.match(/^event:([^\/]+)\/([^\/]+)\/([^\/]+)/))return o[0],n=o[1],e=o[2],o[3],[n,e]},u=function(t){return function(e){var o;return!!(o=i(e))&&(Date.now()-Number(o)<n||(t.myLocalStorage.removeItem(e),!1))}}(this),r=function(t){var n;if(n=a(t))return n[0]},i=function(t){var n;if(n=a(t))return n[1]},o=function(){var t,n;n=[];for(t in window.localStorage)n.push(u(t));return n},o(),$(this.window).bind("storage",function(){return function(t){var n,e;if(e=t.originalEvent,u(e.key)){n=e.newValue;try{n=JSON.parse(e.newValue)}catch(t){t}return $(document).trigger(r(e.key),n)}}}())}return t.prototype.trigger=function(t,n){return null==n&&(n=null),$(this.document).trigger(t,n),this},t.prototype.triggerAllWindows=function(t,n){var e;return null==n&&(n=null),this.trigger(t,n),e=Math.floor(2147483648*Math.random()),this.myLocalStorage.setItem("event:"+t+"/"+Date.now()+"/"+e,JSON.stringify(n)),this},t.prototype.on=function(t,n){return $(this.document).bind(t,function(){return function(t,e){var o,r;try{return n(e)}catch(t){return o=t,r=function(){throw o},setTimeout(r,1)}}}()),this},t}(),t=function(){function t(t,n){this.eventBus=t,this.rootScope=n}return t.prototype.on=function(t,n){return this.eventBus.on(t,function(t){return function(e){return t.rootScope.$evalAsync(function(){return n(e)})}}(this))},t.prototype.trigger=function(){var t,n;return t=1<=arguments.length?o.call(arguments,0):[],(n=this.eventBus).trigger.apply(n,t)},t.prototype.triggerAllWindows=function(){var t,n;return t=1<=arguments.length?o.call(arguments,0):[],(n=this.eventBus).triggerAllWindows.apply(n,t)},t}(),window.eventBus||(window.eventBus=new e(window,document)),window.angular&&angular.module("giEvents").factory("eventBus",["$rootScope",function(n){return new t(window.eventBus,n)}])}.call(this),function(){var t,n=[].indexOf||function(t){for(var n=0,e=this.length;n<e;n++)if(n in this&&this[n]===t)return n;return-1};t=function(){function t(){}var e,o,r,i,a,u,l,s,c,d,f;return o=function(){return siteMap.cleanRelativePath("/collaboration/boards/"+r())},r=function(){var t;return(null!=(t=window.giLocalStorage)?t.getItem("collaboration.currentBoardId"):void 0)||"default"},function(){var t;return!!(null!=(t=window.giLocalStorage)?t.getItem("collaboration.hasVisitedBoards"):void 0)},s=function(t){var n,e;if(n=r(),null!=(e=window.giLocalStorage)&&e.setItem("collaboration.currentBoardId",t),"default"===n&&n!==t)return eventBus.triggerAllWindows("collaboration.defaultBoardGotId",t)},u=function(t){var n,e;return{id:t.id,asset_count:(null!=t?t.total_asset_count:void 0)||(null!=t?t.asset_count:void 0)||(null!=t&&null!=(n=t.assets)?n.length:void 0),comment_count:null!=t&&null!=(e=t.comments)?e.length:void 0}},e=function(){return eventBus.on("collaboration.boardLoaded",function(t){if(t)return f(t)}),eventBus.on("collaboration.boardStatsLoaded",function(t){return f(t)})},f=function(t){var n,e,o;if(!window.headerBoardIconHasUpdater&&(e=$("header .actions #open_board"),e.length>0))return c(),d(t.id),n=t.total_asset_count||t.asset_count||(null!=(o=t.assets)?o.length:void 0)||0,n&&n>0?(e.hasClass("has-items")||e.addClass("has-items"),e.find(".favorites-count").html("<span class='count'>"+n+"</span>")):(e.removeClass("has-items"),e.find(".favorites-count").html(""))},l=function(){return $("header .actions #open_board").addClass("ng-hide")},c=function(){return $("header .actions #open_board").removeClass("ng-hide")},function(){var t;return t="/collaboration/boards",window.location.pathname.match(t)},d=function(t){return t||(t="default"),$("#open_board a").attr("href",siteMap.cleanRelativePath("/collaboration/boards/"+t))},a=function(){return"default"!==r()?i():$.get(o()+"/stats").success(function(t){return eventBus.triggerAllWindows("collaboration.boardStatsLoaded",t)})},i=function(t){return null==t&&(t=0),t++,$.get(o()+".json?assetsPageSize=1").done(function(){return function(t){var e;return n.call(t.permissions,"CanAddAsset")>=0?(e=u(t),eventBus.triggerAllWindows("collaboration.boardStatsLoaded",e)):(s("default"),a())}}()).fail(function(){return function(n){if(!(t>1))return 404!==n.status&&410!==n.status||s("default"),i(t)}}())},t.disableBoardsNotification=function(){var t;return null!=(t=window.giLocalStorage)?t.setItem("collaboration.boardsNotificationIsDisabled",!0):void 0},t.init=function(){return l(),d(),e(),a(),$("<style>.ng-hide { display: none !important; }</style>").appendTo("body")},t}(),$.Header||($.Header={}),$.Header.HeaderBoardIcon={init:t.init},$(document).safeReady(function(){return t.init(),$("div.boards-notification span.close-icon").on("click",function(){t.disableBoardsNotification()})})}.call(this),function(){$(document).safeReady(function(){var t,n;return"undefined"!=typeof $&&null!==$&&null!=(t=$.AssetDetail)&&null!=(n=t.Favorites)?n.init():void 0})}.call(this);